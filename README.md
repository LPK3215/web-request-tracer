# Web Request Tracer

ä¸€ä¸ªé€šç”¨çš„æµè§ˆå™¨ç½‘ç»œè¯·æ±‚è¿½è¸ªå·¥å…·ï¼Œæ”¯æŒ XHR/fetch è¯·æ±‚çš„æ•è·ã€åˆ†æå’Œå¯¼å‡ºã€‚å¯ç”¨äº API é€†å‘å·¥ç¨‹ã€è°ƒè¯•ã€æ€§èƒ½åˆ†æç­‰åœºæ™¯ã€‚

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Version](https://img.shields.io/badge/version-0.1.0-blue.svg)](https://github.com/yourusername/web-request-tracer)

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¯ **çµæ´»çš„é‡‡é›†æ¨¡å¼**
  - `minimal`: è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼Œä»…é‡‡é›†ç‰¹å®šè¯·æ±‚ï¼ˆå‡å°‘æ•°æ®é‡ï¼‰
  - `all`: é‡‡é›†å…¨éƒ¨ XHR/fetch è¯·æ±‚ï¼ˆé€šç”¨æŠ“åŒ…æ¨¡å¼ï¼‰

- ğŸ’¾ **è·¨é¡µé¢æŒä¹…åŒ–**: æ”¯æŒåŒä¸€ç«™ç‚¹è·¨é¡µé¢ç»§ç»­ç´¯ç§¯è®°å½•

- ğŸ–±ï¸ **ç‚¹å‡»äº‹åŠ¡è¿½è¸ª**: è‡ªåŠ¨å…³è”ç”¨æˆ·ç‚¹å‡»æ“ä½œä¸ç½‘ç»œè¯·æ±‚ï¼Œä¾¿äºåˆ†æç”¨æˆ·è¡Œä¸ºè§¦å‘çš„ API è°ƒç”¨

- ğŸ“¥ **JSON å¯¼å‡º**: ä¸€é”®å¯¼å‡ºå®Œæ•´çš„è¿½è¸ªæ•°æ®ï¼ŒåŒ…å«è¯·æ±‚/å“åº”è¯¦æƒ…

- ğŸ”§ **æ˜“äºå®šåˆ¶**: å¯æ ¹æ®ç›®æ ‡ç½‘ç«™è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™å’Œé‡‡é›†ç­–ç•¥

## ä½¿ç”¨åœºæ™¯

- API é€†å‘å·¥ç¨‹å’Œåˆ†æ
- å‰ç«¯æ€§èƒ½è°ƒè¯•
- ç”¨æˆ·è¡Œä¸ºä¸ç½‘ç»œè¯·æ±‚å…³è”åˆ†æ
- è‡ªåŠ¨åŒ–æµ‹è¯•æ•°æ®æ”¶é›†
- Web åº”ç”¨å®‰å…¨å®¡è®¡

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šæ§åˆ¶å°ç‰ˆæœ¬ï¼ˆæ¨èç”¨äºä¸´æ—¶æµ‹è¯•ï¼‰

é€‚åˆä¸´æ—¶ä½¿ç”¨æˆ–å¿«é€Ÿæµ‹è¯•ï¼š

1. æ‰“å¼€ç›®æ ‡ç½‘ç«™
2. æ‰“å¼€æµè§ˆå™¨ DevTools Consoleï¼ˆF12ï¼‰
3. å¤åˆ¶ç²˜è´´ `src/batchexecute_trace_recorder.js` çš„å†…å®¹å¹¶å›è½¦
4. ç‚¹å‡»å³ä¸‹è§’é¢æ¿çš„ "Start" æŒ‰é’®å¼€å§‹è®°å½•
5. æ‰§è¡Œéœ€è¦è¿½è¸ªçš„æ“ä½œ
6. ç‚¹å‡» "Download JSON" å¯¼å‡ºæ•°æ®

### æ–¹å¼äºŒï¼šç”¨æˆ·è„šæœ¬ç‰ˆæœ¬ï¼ˆæ¨èç”¨äºé•¿æœŸä½¿ç”¨ï¼‰

é€‚åˆé•¿æœŸä½¿ç”¨æˆ–è‡ªåŠ¨åŒ–åœºæ™¯ï¼š

1. å®‰è£… [Tampermonkey](https://www.tampermonkey.net/) æˆ–å…¶ä»–ç”¨æˆ·è„šæœ¬ç®¡ç†å™¨
2. å®‰è£… `src/batchexecute_trace_recorder.user.js` è„šæœ¬
3. æ ¹æ®éœ€è¦ä¿®æ”¹è„šæœ¬ä¸­çš„ `@match` è§„åˆ™ä»¥åŒ¹é…ç›®æ ‡ç½‘ç«™
4. è®¿é—®ç›®æ ‡ç½‘ç«™ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨åŠ è½½
5. ä½¿ç”¨å³ä¸‹è§’çš„æ§åˆ¶é¢æ¿è¿›è¡Œæ“ä½œ

## ç¤ºä¾‹ï¼šGemini Business API è¿½è¸ª

æœ¬å·¥å…·é»˜è®¤é…ç½®ä¸ºè¿½è¸ª Gemini Business çš„ batchexecute APIï¼Œä½œä¸ºä½¿ç”¨ç¤ºä¾‹ï¼š

1. æ‰“å¼€ [Gemini Business Team è®¾ç½®é¡µé¢](https://business.gemini.google/settings/team)
2. æŒ‰ç…§ä¸Šè¿°æ–¹å¼åŠ è½½è„šæœ¬
3. æ‰§è¡Œå›¢é˜Ÿç®¡ç†æ“ä½œï¼ˆlist / add / remove / updateï¼‰
4. å¯¼å‡ºæ•°æ®åˆ†æ API è°ƒç”¨

## æ§åˆ¶é¢æ¿

- **Start/Stop**: å¼€å§‹/åœæ­¢è®°å½•
- **Mode**: åˆ‡æ¢é‡‡é›†æ¨¡å¼ï¼ˆmini/maxï¼‰
- **Download JSON**: å¯¼å‡ºè¿½è¸ªæ•°æ®
- **Clear**: æ¸…é™¤å½“å‰è®°å½•

## è‡ªå®šä¹‰é…ç½®

### åŸºç¡€é…ç½®

åœ¨è„šæœ¬ä¸­ä¿®æ”¹ `CFG` å¯¹è±¡æ¥è‡ªå®šä¹‰è¡Œä¸ºï¼š

```javascript
const CFG = {
  captureMode: "minimal",           // é‡‡é›†æ¨¡å¼: "minimal" æˆ– "all"
  enableClickTransaction: true,     // å¯ç”¨ç‚¹å‡»äº‹åŠ¡è¿½è¸ª
  transactionWindowMs: 3000,        // äº‹åŠ¡çª—å£æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  readResponseBody: true,           // è¯»å–å“åº”ä½“
  maxResponseTextLen: 200000,       // æœ€å¤§å“åº”æ–‡æœ¬é•¿åº¦
  persist: true,                    // å¯ç”¨æŒä¹…åŒ–
  maxEvents: 1200,                  // æœ€å¤§äº‹ä»¶æ•°é‡
};
```

### è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼ˆminimal æ¨¡å¼ï¼‰

ä¿®æ”¹ `shouldRecord` å‡½æ•°æ¥å®šä¹‰ä½ è‡ªå·±çš„è¿‡æ»¤è§„åˆ™ï¼š

```javascript
const shouldRecord = (u, method, parsedBody) => {
  if (!u || u.error) return false;
  if (CFG.captureMode === "all") return true;

  // ç¤ºä¾‹ 1: åªè®°å½•ç‰¹å®šåŸŸåçš„è¯·æ±‚
  if (u.host === "api.example.com") return true;

  // ç¤ºä¾‹ 2: åªè®°å½•ç‰¹å®šè·¯å¾„çš„è¯·æ±‚
  if (u.pathname.includes("/api/v1/")) return true;

  // ç¤ºä¾‹ 3: åªè®°å½• POST è¯·æ±‚
  if (method === "POST") return true;

  // ç¤ºä¾‹ 4: æ ¹æ®è¯·æ±‚ä½“å†…å®¹è¿‡æ»¤
  if (parsedBody?.value?.action === "getData") return true;

  return false;
};
```

### ç”¨æˆ·è„šæœ¬åŒ¹é…è§„åˆ™

ä¿®æ”¹ `@match` æ¥æŒ‡å®šè„šæœ¬è¿è¡Œçš„ç½‘ç«™ï¼š

```javascript
// @match        https://example.com/*           // åŒ¹é…ç‰¹å®šåŸŸå
// @match        https://*.example.com/*         // åŒ¹é…æ‰€æœ‰å­åŸŸå
// @match        *://*/*                         // åŒ¹é…æ‰€æœ‰ç½‘ç«™ï¼ˆé»˜è®¤ï¼‰
```

## å¯¼å‡ºæ•°æ®æ ¼å¼

å¯¼å‡ºçš„ JSON æ–‡ä»¶åŒ…å«ï¼š

- `meta`: å…ƒæ•°æ®ï¼ˆå¼€å§‹æ—¶é—´ã€ç”¨æˆ·ä»£ç†ã€URL ç­‰ï¼‰
- `events`: äº‹ä»¶åˆ—è¡¨ï¼ˆç½‘ç»œè¯·æ±‚ã€ç‚¹å‡»äº‹ä»¶ç­‰ï¼‰
- `transactions`: äº‹åŠ¡æ˜ å°„ï¼ˆç‚¹å‡»ä¸ç½‘ç»œè¯·æ±‚çš„å…³è”ï¼‰
- `state`: å½“å‰çŠ¶æ€ï¼ˆè¿è¡ŒçŠ¶æ€ã€é‡‡é›†æ¨¡å¼ï¼‰

## æ³¨æ„äº‹é¡¹

- æœ¬å·¥å…·ä¼šè¯»å–å’Œè®°å½•ç½‘ç»œè¯·æ±‚çš„å†…å®¹ï¼Œè¯·æ³¨æ„æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤
- åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ—¶ï¼Œå»ºè®®ä½¿ç”¨ `minimal` æ¨¡å¼å¹¶é…ç½®ä¸¥æ ¼çš„è¿‡æ»¤è§„åˆ™
- å¯¼å‡ºçš„ JSON æ–‡ä»¶å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¯·å¦¥å–„ä¿ç®¡
- æŸäº›ç½‘ç«™å¯èƒ½æœ‰ CSPï¼ˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼‰é™åˆ¶ï¼Œå¯èƒ½å½±å“è„šæœ¬è¿è¡Œ

## æŠ€æœ¯åŸç†

- é€šè¿‡ Hook `XMLHttpRequest` å’Œ `fetch` API æ‹¦æˆªç½‘ç»œè¯·æ±‚
- ä½¿ç”¨ `localStorage` å®ç°è·¨é¡µé¢æ•°æ®æŒä¹…åŒ–
- é€šè¿‡äº‹ä»¶ç›‘å¬å™¨æ•è·ç”¨æˆ·ç‚¹å‡»è¡Œä¸º
- ä½¿ç”¨æ—¶é—´çª—å£ç®—æ³•å…³è”ç‚¹å‡»äº‹ä»¶ä¸ç½‘ç»œè¯·æ±‚

## é¡¹ç›®ç»“æ„

```
web-request-tracer/
â”œâ”€â”€ docs/                                       # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ API.md                                 # API æ–‡æ¡£
â”‚   â””â”€â”€ USAGE.md                               # ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ src/                                        # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ batchexecute_trace_recorder.js         # æ§åˆ¶å°ç‰ˆæœ¬
â”‚   â””â”€â”€ batchexecute_trace_recorder.user.js    # ç”¨æˆ·è„šæœ¬ç‰ˆæœ¬
â”œâ”€â”€ .gitignore                                  # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ CHANGELOG.md                                # æ›´æ–°æ—¥å¿—
â”œâ”€â”€ LICENSE                                     # MIT è®¸å¯è¯
â””â”€â”€ README.md                                   # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](docs/QUICKSTART.md) - 5 åˆ†é’Ÿä¸Šæ‰‹æŒ‡å—
- [ä½¿ç”¨æŒ‡å—](docs/USAGE.md) - è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œé…ç½®æŒ‡å—
- [API æ–‡æ¡£](docs/API.md) - å®Œæ•´çš„ API å‚è€ƒæ–‡æ¡£

## æ›´æ–°æ—¥å¿—

æŸ¥çœ‹ [CHANGELOG.md](CHANGELOG.md) äº†è§£ç‰ˆæœ¬æ›´æ–°å†å²ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

è´¡çŒ®æŒ‡å—ï¼š
1. Fork æœ¬ä»“åº“
2. åˆ›å»ºä½ çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤ä½ çš„æ”¹åŠ¨ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ä¸€ä¸ª Pull Request

## ç›¸å…³é¡¹ç›®

- [Fiddler](https://www.telerik.com/fiddler) - åŠŸèƒ½å¼ºå¤§çš„ HTTP è°ƒè¯•ä»£ç†
- [Charles](https://www.charlesproxy.com/) - è·¨å¹³å° HTTP ä»£ç†å·¥å…·
- [Chrome DevTools](https://developer.chrome.com/docs/devtools/) - æµè§ˆå™¨å†…ç½®å¼€å‘è€…å·¥å…·

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ [Issue](https://github.com/yourusername/web-request-tracer/issues)
- å‘é€é‚®ä»¶è‡³ï¼šyour.email@example.com
